<!DOCTYPE html>
<html>
<head>
    <title>Music Player</title>
    <link rel="stylesheet" href="/static/Styles/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Poppins:ital,wght@0,500;0,700;1,400;1,600&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
        <div id="player">
                <h1 class="topic">Music Player</h1>
                <div class="listhead">
                <h2>Songs</h2>
               <input type="text" id="searchBar" placeholder="Search for a song...">
               </div>
        <div class="song-list-container">
              <ul id="song-list">
              </ul>
        </div>
   <div class="bottom">
    <div class="name">
            <p id="songName"></p>
    </div>
   <div class="player">
    <audio  id="audioPlayer" controls class="playeraudio1">
        <source src="/static/audio/Audio-1.mp3" type="audio/mpeg">
    </audio>
   </div>
    <div class="buttons">
        <div class="butdiv">
            <button id="prev">
            <button type="button" onclick="previous()">&#171;</button>
        </button>
        </div>
        <div class="butdiv">
    <button type="button" id="playPauseButton" onclick="togglePlayPause()">
        <span id="playPauseIcon">&#9658</span>
    </button> 
</div>
        <div class="butdiv">
            <button id="next">
                <button type="button" onclick="next()">&#187;</button>
            </button>
        </div>
        
      <div class="butdiv">
            <button type="button" id="shuffleButton" onclick="toggleShuffle()"><img src="/static/shuffle.png"class="shuffle"></button>
        </div>
        <div class="butdiv">
    <button type="button" id="loopButton" onclick="toggleLoop()"><img src="/static/loop.png"class="shuffle"></button>
  </div>
        
    </div>
    </div>
    </div>
    </div>


<script>
// const songElement = document.getElementById('songName');
const songListElement = document.getElementById("song-list");
// var songs = ["/static/audio/song1.mp3", "/static/audio/song2.mp3", "/static/audio/song3.mp3"];
let songs = [];
    for (let i = 1; i <= 48; i++) {
        songs.push(`/static/audio/Audio-${i}.mp3`);
    }
var currentSongIndex = 0;
var shuffle=false; 
const audioPlayer = document.getElementById("audioPlayer");

// songElement.innerText = `song${currentSongIndex}`
let isChangingSong = false; // Flag to prevent changing the song when transitioning

// Highlight the current song
function highlightCurrentSong() {
    // Remove the highlight class from all list items
    const songListItems = songListElement.querySelectorAll("li");
    songListItems.forEach((item) => {
        item.classList.remove("current-song");
    });

    // Add the highlight class to the current song
    songListItems[currentSongIndex].classList.add("current-song");
}

const playPauseButton = document.getElementById("playPauseButton");
const playPauseIcon = document.getElementById("playPauseIcon");
function updateCurrentSongDisplay() {
  // Remove the highlight class from all list items
  const songListItems = songListElement.querySelectorAll("li");
  songListItems.forEach((item) => {
    item.classList.remove("current-song");
  });

  // Add the highlight class to the current song
  songListItems[currentSongIndex].classList.add("current-song");

  // Scroll the current song to the top of the list
  songListItems[currentSongIndex].scrollIntoView({ behavior: "smooth", block: "start" });
}
audioPlayer.addEventListener("play", function() {
    playPauseIcon.textContent = '⏸'; // Change to the pause symbol when playing
    if (!isChangingSong) {
        updateCurrentSongDisplay();
    }
});
// Set the initial symbol based on the audio player's initial state
if (audioPlayer.paused) {
    playPauseIcon.textContent = '▶'; // Show the play symbol
} else {
    playPauseIcon.textContent = '⏸'; // Show the pause symbol
}

function togglePlayPause() {
    if (audioPlayer.paused) {
        audioPlayer.play();
        playPauseIcon.textContent = '⏸'; // Change to the pause symbol
    } else {
        audioPlayer.pause();
        playPauseIcon.textContent = '▶'; // Change to the play symbol
    }
}

audioPlayer.addEventListener("play", function() {
    playPauseIcon.textContent = '⏸'; // Change to the pause symbol when playing
});

audioPlayer.addEventListener("pause", function() {
    playPauseIcon.textContent = '▶'; // Change to the play symbol when paused
});


function next() {
  const nextSongIndex = getNextSongIndex();
  currentSongIndex = nextSongIndex;
  audioPlayer.src = songs[nextSongIndex];
  audioPlayer.play();

  // Manually update the current song display
  updateCurrentSongDisplay();
}

function previous() {
  const prevSongIndex = getPrevSongIndex();
  currentSongIndex = prevSongIndex;
  audioPlayer.src = songs[prevSongIndex];
  audioPlayer.play();
  updateCurrentSongDisplay();
}
function getNextSongIndex() {
  if (shuffle) {
    return getRandomSongIndex();
  }
  return (currentSongIndex + 1) % songs.length;
}

function getPrevSongIndex() {
  if (shuffle) {
    return getRandomSongIndex();
  }
  return (currentSongIndex - 1 + songs.length) % songs.length;
}

function getRandomSongIndex() {
  const currentIndex = currentSongIndex;
  let randomIndex = currentIndex;
  while (randomIndex === currentIndex) {
    randomIndex = Math.floor(Math.random() * songs.length);
  }
  return randomIndex;
}
// JavaScript code
var shuffleButton = document.querySelector(".shuffle");
function toggleShuffle() {
  if (shuffle) {
    shuffleButton.classList.remove("active");
    shuffle = false;
    
  } else {
    shuffleButton.classList.add("active");
    shuffle = true;
  }
}

// const audioPlayer = document.getElementById("audioPlayer");
const songNameElement = document.getElementById("songName");

// Update the song name element when the audio player starts playing a new song.
audioPlayer.addEventListener("play", () => {
  const songName = audioPlayer.currentSrc.split("/").pop();
  songNameElement.textContent = songName;
});


// const songListElement = document.getElementById("song-list");

songs.forEach((song) => {
  const songListItemElement = document.createElement("li");
  // Get the name of the song from the URL.
  const songName = song.split("/").pop();
  songListItemElement.textContent = songName;
  songListElement.appendChild(songListItemElement);
});
songListElement.addEventListener("click", (event) => {
  // Get the song URL from the clicked song list item element.
  var songUrl = event.target.textContent;
  console.log(songUrl);
  songUrl='/static/audio/'+songUrl;
  // Set the audio player source to the song URL.
  currentSongIndex = songs.indexOf(songUrl);
  console.log(currentSongIndex);
  audioPlayer.src = songUrl;
  // Play the song.
  audioPlayer.play();
});
// const audioPlayer = document.getElementById("audioPlayer");

audioPlayer.addEventListener("ended", function() {
    next(); // Automatically go to the next song
    updateCurrentSongDisplay();
});


audioPlayer.addEventListener("ended", function() {
    isChangingSong = true;
    // Clear the timestamp when a song ends
    timeStamp.textContent = "0:00 / 0:00";
    setTimeout(() => {
        isChangingSong = false;
    }, 1); // Delay to allow for smooth transition
});
audioPlayer.addEventListener("play", function() {
    playPauseIcon.textContent = '⏸'; // Change to the pause symbol when playing
    if (!isChangingSong) {
        highlightCurrentSong();
    }
});

audioPlayer.addEventListener("pause", function() {
    playPauseIcon.textContent = '▶'; // Change to the play symbol when paused
});

// Update the song list items to change the song
songListElement.addEventListener("click", (event) => {
    // Get the song URL from the clicked song list item element.
    var songUrl = event.target.textContent;
    console.log(songUrl);
    songUrl = '/static/audio/' + songUrl;
    
    // Set the audio player source to the song URL.
    currentSongIndex = songs.indexOf(songUrl);
    console.log(currentSongIndex);
    audioPlayer.src = songUrl;

    if (!isChangingSong) {
        highlightCurrentSong();
    }

    // Play the song.
    audioPlayer.play();
});
function scrollToTopOfSelectedSong() {
  const songListItems = songListElement.querySelectorAll("li");
  songListItems[currentSongIndex].scrollIntoView({ behavior: "smooth", block: "start" });
}
songListElement.addEventListener("click", (event) => {
  // Get the song URL from the clicked song list item element.
  var songUrl = event.target.textContent;
  songUrl = '/static/audio/' + songUrl;
  
  // Set the audio player source to the song URL.
  currentSongIndex = songs.indexOf(songUrl);
  audioPlayer.src = songUrl;

  // Play the song.
  audioPlayer.play();

  // Update the current song display and scroll to the top of the selected song.
  updateCurrentSongDisplay();
  scrollToTopOfSelectedSong();
});
const loopButton = document.getElementById("loopButton");
let isLooping = false; // Flag to track loop state

function toggleLoop() {
  isLooping = !isLooping;
  audioPlayer.loop = isLooping;
  if (isLooping) {
    loopButton.classList.add("active");
  } else {
    loopButton.classList.remove("active");
  }
}
const searchBar = document.getElementById("searchBar");
function filterSongs() {
  const searchTerm = searchBar.value.toLowerCase();
  const songListItems = songListElement.querySelectorAll("li");

  songListItems.forEach((item) => {
    const songName = item.textContent.toLowerCase();
    if (songName.includes(searchTerm)) {
      item.style.display = "block"; // Display matching songs
    } else {
      item.style.display = "none"; // Hide non-matching songs
    }
  });
}

// Add an input event listener to trigger the filtering
searchBar.addEventListener("input", filterSongs);
</script>
</body>
</html>
